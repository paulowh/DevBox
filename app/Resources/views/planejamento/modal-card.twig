<div class="card-modal-backdrop" onclick="closeCardModal()"></div>

<!-- Modal deslizando da direita -->
<div class="card-modal-content animate-slide-in-right">
  <div
      class="card-modal-content">
    <!-- Header fixo -->
    <div class="card-modal-header">
      <div>
        <h2 id="card-modal-header-title" class="card-modal-title">
          Editar Card
        </h2>
        <p id="card-modal-header-id" class="card-modal-subtitle">ID: -</p>
      </div>

      <div class="d-flex align-items-center gap-3">
        <button id="card-edit-toggle-btn" class="ui button" onclick="toggleCardEditing()"
                style="background-color: var(--bg-card); color: var(--text-primary)">
          Editar
        </button>

        <button class="ui button" onclick="closeCardModal()"
                style=" background-color: var(--bg-tertiary); color: var(--text-secondary);">
          ✕
        </button>
      </div>
    </div>

    <!-- Loading State -->
    <div id="card-modal-loading" class="text-center py-5" style="display: none">
      <div class="spinner-border text-primary mb-3" role="status">
        <span class="visually-hidden">Carregando...</span>
      </div>
      <p style="color: var(--text-secondary)">Carregando dados do card...</p>
    </div>

    <!-- Error State -->
    <div id="card-modal-error" class="alert alert-danger m-4" style="display: none">
      <p class="fw-bold mb-1">Erro ao carregar dados:</p>
      <p id="card-modal-error-message" class="mb-0 small"></p>
    </div>
    <!-- Content -->
    <div id="card-modal-body" class="card-modal-body">
      <form id="form" class="ui grid form">

        <!-- Coluna Principal (Título e Descrição) -->
        <div class="ten wide column">
          <!-- Modo Visualização -->
          <div id="card-view-mode">
            <h1 id="card-view-title" class="card-view-title">
              {{ titulo }}
            </h1>
            <h1 id="card-view-title" class="card-title">
              {{ descricao }}
            </h1>
            <div class="border-bottom my-3" style="border-color: var(--border-solid) !important"></div>
            <div id="card-view-description" class="card-view-description"></div>
          </div>

          <!-- Modo Edição -->
          <div id="card-edit-mode" style="display: none">
            <div class="field">
              <input type="text" id="card-edit-title" name="card-edit-title" class="card-edit-title-input"
                     placeholder="Título do card..."
                     value="{{ titulo }}"/>
            </div>
            <div class="border-bottom my-3" style="border-color: var(--border-solid) !important"></div>
            <div class="field">
              <label class="form-label fw-medium"
                     style="font-size: 0.875rem; color: var(--text-secondary)">Descrição</label>
              <textarea id="card-edit-description" name="card-edit-description" rows="30"
                        class="card-edit-description-textarea">{{ descricao }}</textarea>
            </div>
            <div class="d-flex gap-2 mt-5">
              {% if create %}
                <button onclick="handleCardCreate()" class="ui primary basic button">
                  Criar
                </button>
              {% else %}
                <button onclick="handleCardUpdate()" class="ui primary basic button">
                  Atualizar
                </button>

              {% endif %}
              <button onclick="toggleCardEditing()" class="ui secondary basic button">
                Cancelar
              </button>
            </div>

            <div class="ui error message"></div>

          </div>
        </div>

        <div class="six wide column">
          <div class="card-field-group field">
            <label class="card-field-label">Turma</label>
            <select id="card-field-turma" name="card-field-turma"
                    class="card-field-select ui dropdown search drop-turmas" disabled>
              <option value="">Selecione...</option>
              {% for t in turmas %}
                <option value="{{ t.id }}">{{ t.nome }}</option>
              {% endfor %}
            </select>
          </div>

          <div class="card-field-group field">
            <label class="card-field-label">Curso</label>
            <select id="card-field-curso" name="card-field-curso"
                    class="card-field-select ui dropdown search drop-cursos" disabled>
              <option value="">Selecione...</option>
              {% for c in cursos %}
                <option value="{{ c.id }}">{{ c.nome_curso }}</option>
              {% endfor %}
            </select>
          </div>

          <div class="card-field-group field">
            <label class="card-field-label">UC</label>
            <select id="card-field-uc" name="card-field-uc"
                    class="card-field-select search ui dropdown search drop-ucs"
                    onchange="handleUcChange(event)" disabled>
              <option value="">Selecione a UC...</option>
              {% for u in ucs %}
                <option value="{{ u.id }}">{{ u.sigla }} - {{ u.nome_completo }}</option>
              {% endfor %}
            </select>
          </div>

          <div class="card-field-group field">
            <label class="card-field-label">Aula Inicial</label>
            <input type="date" value="{{ aula_incial ? aula_inicial|date('Y-m-d') : '' }}" id="card-field-aula-inicial"
                   class="card-field-input mini ui form" disabled/>
          </div>

          <div class="card-field-group field">
            <label class="card-field-label">Aula Final</label>
            <input type="date" value="{{ aula_final ? aula_final|date('Y-m-d') : '' }}" id="card-field-aula-final"
                   class="card-field-input ui mini form" disabled/>
          </div>

          <div class="card-field-group field">
            <label class="card-field-label">Indicadores</label>
            <select name="" multiple="" class="ui fluid search dropdown indicadores card-field-select"
                    id="card-field-indicadores-container" disabled>
              <option value="">Selecione UC..</option>
            </select>
          </div>

          <div class="card-field-group field">
            <label class="card-field-label">Conhecimentos</label>
            <select name="skills" multiple="" class="ui fluid search dropdown conhecimentos card-field-select"
                    id="card-field-conhecimentos-container" disabled>
              <option value="">Selecione UC..</option>
            </select>
          </div>

          <div class="card-field-group field">
            <label class="card-field-label">Habilidades</label>
            <select name="skills" multiple="" class="ui fluid search dropdown habilidades card-field-select"
                    id="card-field-habilidades-container" disabled>
              <option value="">Selecione UC..</option>
            </select>
          </div>

          <div class="card-field-group field">
            <label class="card-field-label">Atitudes</label>

            <select name="skills" multiple="" class="ui fluid search dropdown atitudes card-field-select"
                    id="card-field-atitudes-container" disabled>
              <option value="">Selecione UC..</option>
            </select>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>
